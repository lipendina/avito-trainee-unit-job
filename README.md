# Тестовое задание на позицию стажера-бекендера в юнит "Работа"

## Микросервис для работы с балансом пользователей

#### Проблема:

В нашей компании есть много различных микросервисов. Многие из них так или иначе хотят взаимодействовать с балансом пользователя. На архитектурном комитете приняли решение централизовать работу с балансом пользователя в отдельный сервис.

#### Задача:

Необходимо реализовать микросервис для работы с балансом пользователей (зачисление средств, списание средств, перевод средств от пользователя к пользователю, а также метод получения баланса пользователя). Сервис должен предоставлять HTTP API и принимать/отдавать запросы/ответы в формате JSON.

#### Сценарии использования:

Далее описаны несколько упрощенных кейсов приближенных к реальности.

1. Сервис биллинга с помощью внешних мерчантов (аля через visa/mastercard) обработал зачисление денег на наш счет. Теперь биллингу нужно добавить эти деньги на баланс пользователя.
2. Пользователь хочет купить у нас какую-то услугу. Для этого у нас есть специальный сервис управления услугами, который перед применением услуги проверяет баланс и потом списывает необходимую сумму.
3. В ближайшем будущем планируется дать пользователям возможность перечислять деньги друг-другу внутри нашей платформы. Мы решили заранее предусмотреть такую возможность и заложить ее в архитектуру нашего сервиса.

#### Основное задание (минимум):

1. Метод начисления средств на баланс. Принимает id пользователя и сколько средств зачислить.
2. Метод списания средств с баланса. Принимает id пользователя и сколько средств списать.
3. Метод перевода средств от пользователя к пользователю. Принимает id пользователя с которого нужно списать средства, id пользователя которому должны зачислить средства, а также сумму.
4. Метод получения текущего баланса пользователя. Принимает id пользователя. Баланс всегда в рублях.

#### Дополнительные задания

***Доп. задание 1:***

Эффективные менеджеры захотели добавить в наши приложения товары и услуги в различных от рубля валютах. Необходима возможность вывода баланса пользователя в отличной от рубля валюте.

Задача: добавить к методу получения баланса доп. параметр. Пример: ?currency=USD. Если этот параметр присутствует, то мы должны конвертировать баланс пользователя с рубля на указанную валюту. Данные по текущему курсу валют можно взять отсюда <https://exchangeratesapi.io/> или из любого другого открытого источника.

Примечание: базовая валюта которая хранится на балансе у нас всегда рубль. В рамках этой задачи конвертация всегда происходит с базовой валюты.

***Доп. задание 2:***

Пользователи жалуются, что не понимают за что были списаны (или зачислены) средства.

Задача: необходимо предоставить метод получения списка транзакций с комментариями откуда и зачем были начислены/списаны средства с баланса. Необходимо предусмотреть пагинацию и сортировку по сумме и дате.


## Инструкция по запуску

#### Сборка проекта

Для создания образа из Dockerfile выполняется следующая команда из того же каталога, в котором находится файл docker-compose.yml:

`$ docker-compose build`


#### Запуск проекта

Теперь, когда проект собран, его можно запустить с помощью команды:

`$ docker-compose up`

После выполнения этой команды в терминале должен появиться текст: `Server is listening...`

#### API методы 

***Метод начисления средств на баланс***

Запрос:

```
curl --header "Content-Type: application/json"
    --request POST
    --data '{"user_id": "<USER_ID>", "amount": {"int_part": 5000, "frac_part": 0}}'   
    http://localhost:9000/balance/credit
```

Ответ: сообщение об успешном выполнении или HTTP-код ошибки + описание ошибки.

***Метод списания средств с баланса***

Запрос:

```
curl --header "Content-Type: application/json"   
    --request POST   
    --data '{"user_id": "<USER_ID>", "amount": {"int_part": 5000, "frac_part": 0}}'   
    http://localhost:9000/balance/withdraw
```

Ответ: сообщение об успешном выполнении или HTTP-код ошибки + описание ошибки.

***Метод перевода средств от пользователя к пользователю***

Запрос:

```
curl --header "Content-Type: application/json"   
    --request POST   
    --data '{"sender_id": "<SENDER_ID>", "receiver_id": "<RECEIVER_ID>", "amount": {"int_part": 3000, "frac_part": 0}}'   
    http://localhost:9000/balance/transfer
```

Ответ: сообщение об успешном выполнении или HTTP-код ошибки + описание ошибки.

***Метод получения текущего баланса пользователя***

Запрос:

```
curl --request GET  
"http://localhost:9000/balance/get?user_id=<USER_ID>&currency=USD"
```

Ответ: текущий баланс пользователя в указанной валюте (по умолчанию в рублях) или HTTP-код ошибки + описание ошибки.

***Метод получения транзакций пользователя***

Запрос:

```
curl --request GET  
"http://localhost:9000/balance/transactions?user_id=<USER_ID>&limit=10&offset=0"
```

Ответ: список транзакций пользователя, отсортированных по сумме (от наименьшей к наибольшей) и дате (от самой поздней к самой ранней) или HTTP-код ошибки + описание ошибки.